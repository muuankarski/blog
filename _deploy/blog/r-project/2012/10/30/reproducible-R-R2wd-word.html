<!DOCTYPE html>
<html lang="en"> <!-- Set this to the main language of your site -->
<head>
	<!-- Define the page charset to be utf-8 -->
	<meta charset="utf-8" />
	
    <title>Reproducible reports using R, R2wd-package and MS Word Markus Kainu</title>
	
	<!-- Enter a brief description of your page -->
	<meta name="description" content="">
	
	<!-- Define a viewport to mobile devices to use - telling the browser to assume that the page is as wide as the device (width=device-width) and setting the initial page zoom level to be 1 (initial-scale=1.0) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Atom Feed -->
    <link href="/blog/feed.xml" rel="alternate" title="Markus Kainu's Blog Post Feed" type="application/atom+xml">
	
	<!-- Add normalize.css which enables browsers to render all elements more consistently and in line with modern standards as it only targets particular styles that need normalizing -->
	<link href="/css/normalize.css" rel="stylesheet" media="all" />

    <!-- Add bootstrap which makes everything better -->
    <link href="/css/readable-bootstrap.min.css" rel="stylesheet" media="all" />
    <link href="/css/font-awesome.min.css" rel="stylesheet" media="all" />
    <!--
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" />

    <!-- Stylesheet for Pygments highlighting -->
    <link href="/css/pygments.css" rel="stylesheet" media="all" />

    <!-- Include the site stylesheet -->
	<link href="/css/styles.css" rel="stylesheet" media="all" />
	
	<!-- Include the HTML5 shiv and shiv print polyfills for Internet Explorer browsers 8 and below -->
	<!--[if lt IE 9]>
		<script src="/js/html5shiv.js" media="all"></script>
		<script src="/js/html5shiv-printshiv.js" media="print"></script>
	<![endif]-->

</head>
<body>

    <div class="container">

	<!-- The page header typically contains items such as your site heading, logo and possibly the main site navigation -->
	<!-- ARIA: the landmark role "banner" is set as it is the prime heading or internal title of the page --> 
	<header role="banner" class="subhead">
	
		<!-- ARIA: the landmark role "navigation" is added here as the element contains site navigation -->
		<div class="subnav">
			<!-- This can contain your site navigation either in an unordered list or even a paragraph that contains links that allow users to navigate your site -->
            <ul class="nav nav-pills pull-right">
                <li><a href="/blog/">blog</a></li>
                <li><a href="/about.html">about</a></li>
                <li><a href="/resources.html">resources</a></li>
                <li><a title="code" href="http://github.com/muuankarski">
                    <i class="icon-github"></i></a></li>
                <li><a title="tweets" href="https://twitter.com/muuankarski">
                    <i class="icon-twitter"></i></a></li>
                <li><a title="email" href="mailto:markuskainu@gmail.com">
                    <i class="icon-envelope"></i></a></li>
            </ul>
		</div>

		<h3><a href="/">Markus Kainu</a></h3>	
		
	</header>
	
	<!-- If you want to use an element as a wrapper, i.e. for styling only, then <div> is still the element to use -->
	<div class="wrap content shadow">
	
        <h1 class="pull-right"><small>Tuesday - Oct 30, 2012</small></h1>

<h1 class="post-title">Reproducible reports using R, R2wd-package and MS Word</h1>

<h2>Objective</h2>

<p>There are some people who still use for MS Word for something else than just writing shopping lists. For work, I mean. To introduce the idea of <a href="http://reproducibleresearch.net/index.php/Main_Page">reproducible reseach/analysis</a> I created this tutorial with a short video and some code to play with. Also, check out <a href="http://markuskainu.fi/material/presentation/reproducible20121030.pdf">slides</a> I used to present this work flow at the [http://www.csa.gov.et/&quot;&gt;Ethiopian Statistical Office] in Spring 2012. And, check the [CRAN taks view](http://cran.stat.ucla.edu/web/views/ReproducibleResearch.html, too</p>

<h3>Reproducible Research - What and Why?</h3>

<p><strong>Two key points:</strong></p>

<ol>
<li>transparency and reproducibility for science and</li>
<li>making documents technically reproducible streamlines the work flow of documents of similar content and structure</li>
</ol>

<ul>
<li>Idea here is to use <strong>open source research tools in a way that allow programmability of the analysis from the disseminated microdata to publication ready tables and graphs.</strong></li>
<li>This approach challenges the labour intensive, error prone and non-reproducible SPSS/STATA/SAS -&gt; Excel -&gt; Word -workflow.</li>
<li>Here we use Windows 7 OS, MS Word 2007 text processing and R 2.15.1 environment through <a href="http://www.rstudio.com/ide/">Rstudio-IDE</a>.</li>
</ul>

<div class="highlight"><pre><code class="r"><span class="c1">###########################################################</span>
<span class="c1">###########################################################</span>
<span class="c1">## Demo - Reporting Life in Transition Survey 2011 using</span>
<span class="c1">## R and MS Word - 30.10.2012 by Markus Kainu</span>
<span class="c1">###########################################################</span>
<span class="c1">###########################################################</span>


<span class="c1">###########################################################</span>
<span class="c1">###------------------ PART 1 ---------------------------###</span>
<span class="c1">#---- LOAD DATA FROM EBRD AND CLEAN IT FOR ANALYSIS ----- #</span>
<span class="c1">###########################################################</span>
<span class="c1">###########################################################</span>
<span class="c1">###########################################################</span>


<span class="c1">## Load Required Packages ##</span>

library<span class="p">(</span>car<span class="p">)</span>
library<span class="p">(</span>reshape2<span class="p">)</span>
library<span class="p">(</span>foreign<span class="p">)</span>
library<span class="p">(</span>stringr<span class="p">)</span>

<span class="c1">###########################################################</span>
<span class="c1">## Load Data ##</span>
temp <span class="o">&lt;-</span> tempfile<span class="p">()</span>
download.file<span class="p">(</span><span class="s">&quot;http://www.ebrd.com/downloads/research/surveys/lits2.dta&quot;</span><span class="p">,</span> temp<span class="p">)</span>
lits2 <span class="o">&lt;-</span> read.dta<span class="p">(</span>temp<span class="p">)</span>

<span class="c1">###########################################################</span>
<span class="c1">## Clean data ##</span>
<span class="c1"># remove whitespaces from country</span>
lits2<span class="o">$</span>cntry <span class="o">&lt;-</span> str_trim<span class="p">(</span>lits2<span class="o">$</span>country_<span class="p">,</span> side<span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
lits2<span class="o">$</span>cntry <span class="o">&lt;-</span> as.factor<span class="p">(</span>lits2<span class="o">$</span>cntry<span class="p">)</span>
<span class="c1"># Recode &quot;don&#39;t know&quot;  -&gt; &quot;dont know&quot;</span>
lits2<span class="o">$</span>crise <span class="o">&lt;-</span> as.factor<span class="p">(</span>str_replace<span class="p">(</span>lits2<span class="o">$</span>q801<span class="p">,</span> <span class="s">&quot;Don&#39;t know&quot;</span><span class="p">,</span> <span class="s">&quot;Dont know&quot;</span><span class="p">))</span>
<span class="c1"># Rename Sex and Age</span>

lits2<span class="o">$</span>sex <span class="o">&lt;-</span> lits2<span class="o">$</span>q102_1 <span class="c1"># Sex</span>
lits2<span class="o">$</span>age <span class="o">&lt;-</span> lits2<span class="o">$</span>q104a_1 <span class="c1"># Age</span>
lits2<span class="o">$</span>income <span class="o">&lt;-</span> lits2<span class="o">$</span>q227 <span class="c1"># income</span>

<span class="c1">## Merge classes</span>
<span class="c1"># Useless values into Not Applicaple</span>
lits2<span class="o">$</span>crise <span class="o">&lt;-</span> recode<span class="p">(</span>lits2<span class="o">$</span>crise<span class="p">,</span> <span class="s">&quot;c(&#39;Filtered&#39;,&#39;Not applicable&#39;,&#39;Not stated&#39;,&#39;Refused&#39;)=NA&quot;</span><span class="p">)</span>

lits2<span class="o">$</span>crise <span class="o">&lt;-</span> recode<span class="p">(</span>lits2<span class="o">$</span>crise<span class="p">,</span> <span class="s">&quot;&#39;A GREAT DEAL&#39;=&#39;a) A GREAT DEAL&#39;;</span>
<span class="s">                      &#39;A FAIR AMOUNT&#39;=&#39;b) A FAIR AMOUNT&#39;;</span>
<span class="s">                      &#39;JUST A LITTLE&#39;=&#39;c) JUST A LITTLE&#39;;</span>
<span class="s">                      &#39;NOT AT ALL&#39;=&#39;d) NOT AT ALL&#39;;</span>
<span class="s">                      &#39;Dont know&#39;=&#39;e) DONT KNOW&#39;&quot;</span><span class="p">)</span>

<span class="c1">## Recode numerical values into factors</span>

<span class="c1"># Perceived income</span>
lits2<span class="o">$</span>income2 <span class="o">&lt;-</span> recode<span class="p">(</span>lits2<span class="o">$</span>income<span class="p">,</span> <span class="s">&quot;1:3=&#39;a) low income&#39;;</span>
<span class="s">                        4:7=&#39;b) middle income&#39;;</span>
<span class="s">                        8:10=&#39;c) high income&#39;;</span>
<span class="s">                        else=NA&quot;</span><span class="p">)</span>
lits2<span class="o">$</span>income2 <span class="o">&lt;-</span> as.factor<span class="p">(</span>lits2<span class="o">$</span>income2<span class="p">)</span>

<span class="c1">#  Level of education</span>
lits2<span class="o">$</span>education <span class="o">&lt;-</span> recode<span class="p">(</span>lits2<span class="o">$</span>q515<span class="p">,</span> <span class="s">&quot;1:2=&#39;a) no or primary&#39;;</span>
<span class="s">                          3:4=&#39;b) Secondary&#39;;</span>
<span class="s">                          5:7=&#39;c) Tertiary or higher&#39;&quot;</span><span class="p">)</span>
lits2<span class="o">$</span>education <span class="o">&lt;-</span> as.factor<span class="p">(</span>lits2<span class="o">$</span>education<span class="p">)</span>

<span class="c1"># Remove NA cases</span>
lits2 <span class="o">&lt;-</span> lits2<span class="p">[</span> which<span class="p">(</span>lits2<span class="o">$</span>crise<span class="o">!=</span> <span class="s">&#39;NA&#39;</span><span class="p">),</span> <span class="p">]</span>
lits2 <span class="o">&lt;-</span> lits2<span class="p">[</span> which<span class="p">(</span>lits2<span class="o">$</span>income2<span class="o">!=</span> <span class="s">&#39;NA&#39;</span><span class="p">),</span> <span class="p">]</span>
lits2 <span class="o">&lt;-</span> lits2<span class="p">[</span> which<span class="p">(</span>lits2<span class="o">$</span>education<span class="o">!=</span> <span class="s">&#39;NA&#39;</span><span class="p">),</span> <span class="p">]</span>

<span class="c1">### Subset the final dataset ###</span>
df2 <span class="o">&lt;-</span> subset<span class="p">(</span>lits2<span class="p">,</span> select<span class="o">=</span>c<span class="p">(</span><span class="s">&quot;SerialID&quot;</span><span class="p">,</span> <span class="s">&quot;cntry&quot;</span><span class="p">,</span>
                             <span class="s">&quot;sex&quot;</span><span class="p">,</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="c1"># sex and age </span>
                             <span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="s">&quot;XCweight&quot;</span><span class="p">,</span> <span class="c1"># weights</span>
                             <span class="s">&quot;income&quot;</span><span class="p">,</span><span class="s">&quot;income2&quot;</span><span class="p">,</span> <span class="c1"># incomes</span>
                             <span class="s">&quot;crise&quot;</span><span class="p">,</span><span class="s">&quot;education&quot;</span><span class="p">))</span>

<span class="c1">### Select 6 countries)</span>

df <span class="o">&lt;-</span> subset<span class="p">(</span>df2<span class="p">,</span> cntry <span class="o">%in%</span> c<span class="p">(</span><span class="s">&quot;Russia&quot;</span><span class="p">,</span><span class="s">&quot;Sweden&quot;</span><span class="p">,</span><span class="s">&quot;Italy&quot;</span><span class="p">,</span>
                              <span class="s">&quot;Mongolia&quot;</span><span class="p">,</span><span class="s">&quot;Turkey&quot;</span><span class="p">,</span><span class="s">&quot;Poland&quot;</span><span class="p">))</span>
df<span class="o">$</span>cntry <span class="o">&lt;-</span> factor<span class="p">(</span>df<span class="o">$</span>cntry<span class="p">)</span>

<span class="c1">#####################################################</span>
<span class="c1">### Let&#39;s explore the data ###</span>
<span class="c1">#####################################################</span>

head<span class="p">(</span>df<span class="p">)</span>
summary<span class="p">(</span>df<span class="p">)</span>
str<span class="p">(</span>df<span class="p">)</span>

<span class="c1">########################################################</span>
<span class="c1">########################################################</span>
<span class="c1">### ------------- PART 2 ----------------------------###</span>
<span class="c1">#---------- Creation of the Word Document -------------#</span>
<span class="c1">########################################################</span>
<span class="c1">########################################################</span>


<span class="c1">## --------- begin preparations ------- ##</span>

<span class="c1"># In case you don&#39;t have &quot;R2wd&quot; and &quot;rcom&quot; -packages available, install them running following three rows. </span>
<span class="c1"># Command &quot;installstatconnDCOM()&quot; will also install the current version of statconnDCOM that required for</span>
<span class="c1"># R to be able to interact with MS Word</span>

<span class="c1">## --- install packages &quot;R2wd&quot; and &quot;rcom&quot;. --- ##</span>

<span class="c1"># install.packages(&quot;R2wd&quot;)</span>
<span class="c1"># install.packages(&quot;rcom&quot;)</span>
<span class="c1"># installstatconnDCOM()</span>

<span class="c1">## --------- end preparations ------- ##</span>



<span class="c1">#####################################################</span>
<span class="c1">## --------- Creating the document ------- ##</span>

<span class="c1">## OPEN AN EMPTY DOCUMENT IN MS WORD !!!!! ###</span>
<span class="c1">##  THEN RUN THE CODE BELOW ##</span>


library<span class="p">(</span>R2wd<span class="p">)</span>
library<span class="p">(</span>rcom<span class="p">)</span>
library<span class="p">(</span>ggplot2<span class="p">)</span>
library<span class="p">(</span>reshape2<span class="p">)</span>
library<span class="p">(</span>car<span class="p">)</span>
library<span class="p">(</span>survey<span class="p">)</span>
library<span class="p">(</span>arm<span class="p">)</span>

wdGet<span class="p">()</span>
<span class="c1">#####################################################</span>
<span class="c1"># Set page margins and orientation</span>
wdPageSetup<span class="p">(</span>orientation<span class="o">=</span><span class="s">&quot;portrait&quot;</span><span class="p">,</span>
            margins<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span>scope<span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>
wdTitle<span class="p">(</span><span class="s">&quot;Reproducible reports using R and MS Word&quot;</span><span class="p">,</span>
        label<span class="o">=</span><span class="s">&quot;R2wd&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>

<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>
wdSection<span class="p">(</span><span class="s">&quot;Introduction&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;This is an example on how to use the R2wd package for writing tables and graphs directly from microdata.&quot;</span><span class="p">)</span>
<span class="c1">##</span>

<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Plotting the age distribution using ggplot2&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>


plotfun<span class="o">&lt;-</span><span class="kr">function</span><span class="p">(</span>t<span class="p">)</span>
  print<span class="p">(</span>ggplot<span class="p">(</span>df<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>age<span class="p">,</span> color<span class="o">=</span>sex<span class="p">))</span> <span class="o">+</span> 
    geom_density<span class="p">()</span> <span class="o">+</span>
    theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span> <span class="o">+</span>
    facet_wrap<span class="p">(</span><span class="o">~</span>cntry<span class="p">))</span>
wdPlot<span class="p">(</span>t<span class="p">,</span>plotfun<span class="o">=</span>plotfun<span class="p">,</span>
       caption<span class="o">=</span><span class="s">&quot;Unweighted distributions of age by sex&quot;</span><span class="p">,</span>
       height<span class="o">=</span><span class="m">6</span><span class="p">,</span>width<span class="o">=</span><span class="m">5</span><span class="p">)</span>


<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>
wdSection<span class="p">(</span><span class="s">&quot;Statistical tables and graphs&quot;</span><span class="p">,</span> newpage <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;Then we made a section break and started from new page.&quot;</span><span class="p">)</span>
<span class="c1">##</span>


<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Mean age of respondents&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;First, we need a table presenting means and standard errors of age by sex and country in weighted scheme.&quot;</span><span class="p">)</span>
<span class="c1">##</span>


<span class="c1">#####################################################</span>
<span class="c1">### Survey design ###</span>
<span class="c1">#####################################################</span>
library<span class="p">(</span>survey<span class="p">)</span>
d.df <span class="o">&lt;-</span> svydesign<span class="p">(</span>id <span class="o">=</span> <span class="o">~</span>SerialID<span class="p">,</span> 
                  weights <span class="o">=</span> <span class="o">~</span>weight<span class="p">,</span> 
                  data <span class="o">=</span> df<span class="p">)</span>

<span class="c1"># Means and standard errors of age by Sex and Country</span>
t <span class="o">&lt;-</span> data.frame<span class="p">(</span>svyby<span class="p">(</span><span class="o">~</span>age<span class="p">,</span> <span class="o">~</span>sex<span class="o">+</span>cntry<span class="p">,</span> design<span class="o">=</span>d.df<span class="p">,</span> svymean<span class="p">,</span> na.rm<span class="o">=</span><span class="k-Variable">T</span><span class="p">))</span>
names<span class="p">(</span>t<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Sex&quot;</span><span class="p">,</span><span class="s">&quot;Country&quot;</span><span class="p">,</span><span class="s">&quot;mean_age&quot;</span><span class="p">,</span><span class="s">&quot;SE&quot;</span><span class="p">)</span>
t <span class="o">&lt;-</span> t<span class="p">[</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span>

<span class="c1"># lets round the numbers</span>
t<span class="o">$</span>mean_age <span class="o">&lt;-</span> round<span class="p">(</span>t<span class="o">$</span>mean_age<span class="p">,</span> <span class="m">1</span><span class="p">)</span>
t<span class="o">$</span>SE <span class="o">&lt;-</span> round<span class="p">(</span>t<span class="o">$</span>SE<span class="p">,</span> <span class="m">3</span><span class="p">)</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;First, a table with no formatting.&quot;</span><span class="p">)</span>
<span class="c1">##</span>

<span class="c1"># table</span>
wdTable<span class="p">(</span>t<span class="p">)</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;Then, on new page, a table with some formatting.&quot;</span><span class="p">)</span>
<span class="c1">##</span>

<span class="c1"># table</span>
wdTable<span class="p">(</span>t<span class="p">,</span> caption <span class="o">=</span> <span class="s">&quot;Means and standard errors of age by Sex and Country&quot;</span><span class="p">,</span> 
        <span class="c1"># caption.pos=&quot;above&quot;, bookmark = NULL, </span>
        pointsize <span class="o">=</span> <span class="m">9</span><span class="p">,</span> padding <span class="o">=</span> <span class="m">5</span><span class="p">,</span> autoformat <span class="o">=</span> <span class="m">2</span><span class="p">,</span> 
        row.names<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;At last, we also want a graphical illustrations of the age with errorbars showing the standard errors&quot;</span> <span class="p">)</span>
<span class="c1">##</span>

<span class="c1"># errorbars for plot</span>
errorbar <span class="o">&lt;-</span> aes<span class="p">(</span>ymax <span class="o">=</span> mean_age <span class="o">+</span> SE<span class="p">,</span> ymin<span class="o">=</span>mean_age <span class="o">-</span> SE<span class="p">)</span>
<span class="c1"># plot with errorbars</span>
plotfun<span class="o">&lt;-</span><span class="kr">function</span><span class="p">(</span>t<span class="p">)</span>
  print<span class="p">(</span>ggplot<span class="p">(</span>t<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>Country<span class="p">,</span> y<span class="o">=</span>mean_age<span class="p">,</span> fill<span class="o">=</span>Sex<span class="p">))</span> <span class="o">+</span>
    geom_bar<span class="p">(</span>position<span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">,</span> stat<span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_errorbar<span class="p">(</span>errorbar<span class="p">,</span> position<span class="o">=</span><span class="p">(</span>position_dodge<span class="p">(</span>width<span class="o">=</span><span class="m">0.9</span><span class="p">)),</span> width<span class="o">=</span><span class="m">0.25</span><span class="p">)</span> <span class="o">+</span>
    coord_cartesian<span class="p">(</span>ylim<span class="o">=</span>c<span class="p">(</span><span class="m">35</span><span class="p">,</span><span class="m">65</span><span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">))</span>
wdPlot<span class="p">(</span>t<span class="p">,</span>plotfun<span class="o">=</span>plotfun<span class="p">,</span>
       caption<span class="o">=</span><span class="s">&quot;Means and standard errors of age by Sex and Country&quot;</span><span class="p">,</span>
       height<span class="o">=</span><span class="m">4</span><span class="p">,</span>width<span class="o">=</span><span class="m">5</span><span class="p">)</span>

<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Perceived income by countries&quot;</span><span class="p">,</span> newpage <span class="o">=</span> <span class="k-Variable">T</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">## quantities by country and gender</span>
<span class="c1">## as data.frame of relative shares</span>
t <span class="o">&lt;-</span> prop.table<span class="p">(</span>svytable<span class="p">(</span><span class="o">~</span>income2<span class="o">+</span>cntry<span class="p">,</span> d.df<span class="p">),</span><span class="m">2</span><span class="p">)</span>
t2 <span class="o">&lt;-</span> data.frame<span class="p">(</span>t<span class="p">)</span>
t2 <span class="o">&lt;-</span> t2<span class="p">[</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)]</span>

<span class="c1"># for percentages and round at 2 decimal points</span>
t2<span class="o">$</span>Freq <span class="o">&lt;-</span> round<span class="p">((</span>t2<span class="o">$</span>Freq <span class="o">*</span><span class="m">100</span><span class="p">),</span> <span class="m">2</span><span class="p">)</span>

wdTable<span class="p">(</span>t2<span class="p">,</span> caption.pos<span class="o">=</span><span class="s">&quot;above&quot;</span><span class="p">,</span>bookmark <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> 
        pointsize <span class="o">=</span> <span class="m">9</span><span class="p">,</span> padding <span class="o">=</span> <span class="m">5</span><span class="p">,</span> autoformat <span class="o">=</span> <span class="m">3</span><span class="p">,</span> 
        row.names<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>

plotfun<span class="o">&lt;-</span><span class="kr">function</span><span class="p">(</span>t2<span class="p">)</span>
  print<span class="p">(</span>ggplot<span class="p">(</span>t2<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>cntry<span class="p">,</span> y<span class="o">=</span>Freq<span class="p">,</span> fill<span class="o">=</span>income2<span class="p">,</span> label<span class="o">=</span>Freq<span class="p">))</span> <span class="o">+</span> 
    geom_bar<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> position<span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> 
    theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_text<span class="p">(</span>position <span class="o">=</span> position_dodge<span class="p">(</span>width<span class="o">=</span><span class="m">1</span><span class="p">),</span> vjust<span class="o">=</span><span class="m">-0.5</span><span class="p">,</span> size<span class="o">=</span><span class="m">3</span><span class="p">))</span>
wdPlot<span class="p">(</span>t2<span class="p">,</span>plotfun<span class="o">=</span>plotfun<span class="p">,</span>
       caption<span class="o">=</span><span class="s">&quot;Percentage distribution of income classes&quot;</span><span class="p">,</span>
       height<span class="o">=</span><span class="m">3</span><span class="p">,</span>width<span class="o">=</span><span class="m">6</span><span class="p">)</span>

<span class="c1">#####################################################</span>
wdSectionBreak<span class="p">(</span> continuous <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
                bookmark <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>wdapp <span class="o">=</span> .R2wd<span class="p">)</span>

wdPageSetup<span class="p">(</span>orientation<span class="o">=</span><span class="s">&quot;landscape&quot;</span> <span class="p">,</span>scope<span class="o">=</span><span class="s">&quot;section&quot;</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Perceived effect of financial crisis by countries&quot;</span><span class="p">,</span> 
             newpage <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;And then one wide plot on a horizontal page&quot;</span> <span class="p">)</span>
<span class="c1">##</span>

<span class="c1">## quantities by country and crise and income</span>
t <span class="o">&lt;-</span> prop.table<span class="p">(</span>svytable<span class="p">(</span><span class="o">~</span>crise<span class="o">+</span>income2<span class="o">+</span>cntry<span class="p">,</span> d.df<span class="p">),</span><span class="m">3</span><span class="p">)</span>
t2 <span class="o">&lt;-</span> data.frame<span class="p">(</span>t<span class="p">)</span>

<span class="c1"># for percentages and round at 2 decimal points</span>
t2<span class="o">$</span>Freq <span class="o">&lt;-</span> round<span class="p">((</span>t2<span class="o">$</span>Freq <span class="o">*</span><span class="m">100</span><span class="p">),</span> <span class="m">2</span><span class="p">)</span>

<span class="c1"># Plot</span>
plotfun<span class="o">&lt;-</span><span class="kr">function</span><span class="p">(</span>t3<span class="p">)</span>
  print<span class="p">(</span>ggplot<span class="p">(</span>t2<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>cntry<span class="p">,</span> y<span class="o">=</span>Freq<span class="p">,</span> fill<span class="o">=</span>crise<span class="p">,</span> label<span class="o">=</span>Freq<span class="p">))</span> <span class="o">+</span> 
    geom_bar<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> position<span class="o">=</span><span class="s">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> coord_flip<span class="p">()</span> <span class="o">+</span> 
    facet_wrap<span class="p">(</span><span class="o">~</span>income2<span class="p">)</span> <span class="o">+</span> theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_text<span class="p">(</span>position <span class="o">=</span> position_dodge<span class="p">(</span>width<span class="o">=</span><span class="m">1</span><span class="p">),</span> hjust<span class="o">=</span><span class="m">-0.2</span><span class="p">,</span> size<span class="o">=</span><span class="m">2</span><span class="p">))</span>
wdPlot<span class="p">(</span>t3<span class="p">,</span>plotfun<span class="o">=</span>plotfun<span class="p">,</span>
       caption<span class="o">=</span><span class="s">&quot;Percentage distribution of household suffered a great deal of financial crisis&quot;</span><span class="p">,</span>
       height<span class="o">=</span><span class="m">4</span><span class="p">,</span>width<span class="o">=</span><span class="m">8</span><span class="p">)</span>

<span class="c1">#####################################################</span>
wdSectionBreak<span class="p">(</span> continuous <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> 
                bookmark <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>wdapp <span class="o">=</span> .R2wd<span class="p">)</span>

wdPageSetup<span class="p">(</span>orientation<span class="o">=</span><span class="s">&quot;portrait&quot;</span><span class="p">,</span> scope<span class="o">=</span><span class="s">&quot;section&quot;</span><span class="p">)</span>  
<span class="c1">#####################################################</span>

<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Linear Regression&quot;</span><span class="p">,</span> newpage <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">#####################################################</span>
<span class="c1"># Regression:</span>
mod <span class="o">&lt;-</span> svyglm<span class="p">(</span>income<span class="o">~</span>crise<span class="o">+</span>cntry<span class="o">+</span>age<span class="p">,</span> design<span class="o">=</span>d.df<span class="p">)</span>
regr_tab <span class="o">&lt;-</span> data.frame<span class="p">(</span>summary<span class="p">(</span>mod<span class="p">)</span><span class="o">$</span>coefficients<span class="p">)</span>
colnames<span class="p">(</span>regr_tab<span class="p">)</span> <span class="o">&lt;-</span> colnames<span class="p">(</span>summary<span class="p">(</span>mod<span class="p">)</span><span class="o">$</span>coefficients<span class="p">)</span>
regr_tab<span class="p">[</span> <span class="p">,</span><span class="m">4</span><span class="p">]</span> <span class="o">&lt;-</span> ifelse<span class="p">(</span>regr_tab<span class="p">[</span> <span class="p">,</span><span class="m">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">.001</span><span class="p">,</span> <span class="s">&quot;&lt; 0.001&quot;</span><span class="p">,</span> 
                        ifelse<span class="p">(</span>regr_tab<span class="p">[</span> <span class="p">,</span><span class="m">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">.01</span><span class="p">,</span> <span class="s">&quot;&lt; 0.01&quot;</span><span class="p">,</span> 
                               round<span class="p">(</span>regr_tab<span class="p">[</span> <span class="p">,</span><span class="m">4</span><span class="p">],</span> <span class="m">3</span><span class="p">)))</span>
<span class="c1"># print table to doc in word-default format:</span>
wdTable<span class="p">(</span>format<span class="p">(</span>regr_tab<span class="p">),</span> 
        caption <span class="o">=</span> <span class="s">&quot;Linear regression of perceived income&quot;</span><span class="p">,</span> 
        caption.pos<span class="o">=</span><span class="s">&quot;above&quot;</span><span class="p">,</span>bookmark <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> 
        pointsize <span class="o">=</span> <span class="m">9</span><span class="p">,</span> padding <span class="o">=</span> <span class="m">5</span><span class="p">,</span> autoformat <span class="o">=</span> <span class="m">3</span><span class="p">,</span> 
        row.names<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>
wdSubsection<span class="p">(</span><span class="s">&quot;Conclusions&quot;</span><span class="p">,</span> newpage <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="c1">#####################################################</span>

<span class="c1">##</span>
wdBody<span class="p">(</span><span class="s">&quot;Works pretty well. For more information, google: R + R2wd!&quot;</span> <span class="p">)</span>
<span class="c1">##</span>



wdSave<span class="p">(</span><span class="s">&quot;demo_report&quot;</span><span class="p">)</span>
<span class="c1">##</span>
wdQuit<span class="p">()</span>
<span class="c1">#####################################################</span>
<span class="c1">#####################################################</span>


lits2 <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;E:/workspace/lits/lits2/lits2.csv&quot;</span><span class="p">)</span>
</code></pre></div>


<!--
<small class="well" style="padding: 6px;">

    Follow me on <a href="http://twitter.com/muuankarski">Twitter</a>.

</small>
-->

<div style="margin: 15px 0; padding-top: 5px; border-top: 1px solid lightgray;">

<small class="pull-right">
    <a href="/blog/open/science/2013/03/02/toistettava-analyysi-knitr-ja-pandoc.html"
    
    >Toistettava analyysi knitr:n ja pandoc:n avulla R:ssä &rarr;</a>
</small>



<small>
    <a href="/blog/r-project/2012/10/07/mapping-finnish-orienteers.html" title="">&larr; Mapping Finnish orienteers using R</a>
</small>


</div>

<!--
<div style="font-size: 85%;">
Related Posts:
<ul>

    <li><a href="/blog/r-project/2013/11/14/world-values-survey-on-map.html" title="">Visualising World Values Survey on a Map in R</a></li>

    <li><a href="/blog/tools/2013/10/15/markdown-pandoc-tieteellinen-teksti.html" title="">Markdown ja pandoc - tekstipohjaisen tieteellisen kirjoittamisen työvirta</a></li>

    <li><a href="/blog/r-project/2013/09/17/economic-history-dataset-in-r.html" title="">Maddison Project database in R</a></li>

</ul>
</div>
-->

<!--

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'joshbranchaud'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
-->


 <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'markuskainuresearchblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    



		
	</div>


	
	<!-- The main page footer can contain items such as copyright and contact information. It can also contain a duplicated navigation of your site which is not usually contained within a <nav> -->
	<!-- ARIA: the landmark role "contentinfo" is added here as it contains metadata that applies to the parent document -->
	<footer role="contentinfo" style="margin: 10px 5px;">

        <small class="pull-right">With a little help from <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://getbootstrap.com/">Bootstrap</a></small>

		<!-- Copyright information can be contained within the <small> element. The <time> element is used here to indicate that the '2012' is a date -->
		<small>Copyright &copy; <a href="http://markuskainu.fi">Markus Kainu</a> <time datetime="2013">2013</time></small>
		
	</footer>

    </div>
	
	
</body>
</html>

